<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../../">
  <title data-ice="title">apps/airQuality/client/components/Heatmap/HeatmapRow.js | Exposomics</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Discover things you are exposed to"><meta property="og:type" content="website"><meta property="og:url" content="https://doc-ai.github.io/exposomics"><meta property="og:site_name" content="Exposomics"><meta property="og:title" content="Exposomics"><meta property="og:image" content="./docs/asset/logo.png"><meta property="og:description" content="Discover things you are exposed to"><meta property="og:author" content="doc.ai Team &lt;dev@doc.ai&gt;"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Exposomics"><meta property="twitter:description" content="Discover things you are exposed to"><meta property="twitter:image" content="./docs/asset/logo.png"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/doc-ai/exposomics"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#airquality-client">airQuality/client</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/apps/airQuality/client/View.js~View.html">View</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#airquality-client-components-heatmap">airQuality/client/components/Heatmap</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/apps/airQuality/client/components/Heatmap/HeatmapRow.js~HeatmapRow.html">HeatmapRow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/apps/airQuality/client/components/Heatmap/index.js~Heatmap.html">Heatmap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getRelativeCoordinates">getRelativeCoordinates</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#airquality-server">airQuality/server</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-controller">controller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepareData">prepareData</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">apps/airQuality/client/components/Heatmap/HeatmapRow.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React from &apos;react&apos;;
import { func, number, string, arrayOf, any } from &apos;prop-types&apos;;
import getRelativeCoordinates from &apos;./getRelativeCoordinates&apos;;

function drawHeatmapLine({
  node,
  data = [],
  text = &apos;2017&apos;,
  textAlign = &apos;left&apos;,
  itemWidth = 5,
  itemHeight = 20,
  legendWidth = 5,
  font,
  mapValueToColor,
}) {
  const ctx = node.getContext(&apos;2d&apos;);
  const sourceWidth = node.clientWidth;
  const itemsWidth = data.length * itemWidth;
  const scaleFactor = sourceWidth * (1 - legendWidth / 100) / itemsWidth;
  const scaledLegendWidth = Math.floor(
    sourceWidth * legendWidth / (100 * scaleFactor),
  );
  node.width = itemsWidth + scaledLegendWidth;
  node.height = itemHeight;
  const offsetLeft = textAlign === &apos;left&apos; ? scaledLegendWidth : 0;
  ctx.font = font;
  ctx.fillStyle = &apos;black&apos;;
  ctx.textBaseline = &apos;middle&apos;;
  ctx.textAlign = &apos;center&apos;;
  ctx.fillText(
    text,
    (offsetLeft ? 0 : itemsWidth) + scaledLegendWidth / 2,
    node.height / 2,
    scaledLegendWidth * 0.75,
  );
  data.forEach((element, idx) =&gt; {
    ctx.fillStyle = mapValueToColor(element);
    ctx.fillRect(
      offsetLeft + itemWidth * idx + 1,
      0,
      itemWidth - 1,
      itemHeight,
    );
  });
}

class HeatmapRow extends React.PureComponent {
  /* eslint-disable react/no-unused-prop-types */
  static propTypes = {
    data: arrayOf(any).isRequired,
    text: string,
    textAlign: string,
    font: string,
    itemWidth: number,
    itemHeight: number,
    legendWidth: number,
    mapValueToColor: func,
    onSelectEntry: func,
    onMouseLeave: func,
  };

  static defaultProps = {
    text: &apos;&apos;,
    textAlign: &apos;right&apos;,
    font: &apos;20px Arial&apos;,
    itemWidth: 5,
    itemHeight: 20,
    legendWidth: 5,
    mapValueToColor: v =&gt; v,
    onSelectEntry: () =&gt; {},
    onMouseLeave: () =&gt; {},
  };

  componentDidMount() {
    this.drawCanvas();
  }

  componentDidUpdate() {
    this.drawCanvas();
  }

  drawCanvas() {
    drawHeatmapLine({
      node: this.node,

      ...this.props,
    });
  }

  handleMove = e =&gt; {
    const coords = getRelativeCoordinates(e, this.node);
    const width = this.node.clientWidth;
    const percent = coords.x / width * 100;
    const dataWidth = 100 - this.props.legendWidth;
    if (this.props.textAlign === &apos;left&apos; &amp;&amp; percent &lt; this.props.legendWidth) {
      return this.props.onSelectEntry(null);
    }
    if (this.props.textAlign === &apos;right&apos; &amp;&amp; percent &gt; dataWidth) {
      return this.props.onSelectEntry(null);
    }

    const relativePercent = percent / dataWidth;
    return this.props.onSelectEntry(
      this.props.data[Math.round(this.props.data.length * relativePercent)],
    );
  };

  render() {
    return (
      &lt;canvas
        onMouseMove={this.handleMove}
        onMouseLeave={this.props.onMouseLeave}
        ref={node =&gt; {
          this.node = node;
        }}
      /&gt;
    );
  }
}

export default HeatmapRow;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
